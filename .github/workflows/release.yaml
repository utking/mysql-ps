# .github/workflows/release.yaml

on: 
  release:
    types: [created]

jobs:
  release-ubuntu-20_04-amd64:
    name: release linux/amd64
    runs-on: ubuntu-20.04
    steps:
    - uses: actions/checkout@v3
    - uses: wangyoucao577/go-release-action@v1.37
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        goos: linux
        goarch: amd64
        overwrite: TRUE
        ldflags: '-w -s'
        binary_name: "mysql-ps"
        extra_files: .env.example ReadMe.md
        retry: 10
        asset_name: "${BINARY_NAME}-${RELEASE_TAG}-ubuntu-2004-${GOARCH}"
  release-ubuntu-22_04-amd64:
    name: release linux/amd64
    runs-on: ubuntu-22.04
    steps:
    - uses: actions/checkout@v3
    - uses: wangyoucao577/go-release-action@v1.37
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        goos: linux
        goarch: amd64
        overwrite: TRUE
        ldflags: '-w -s'
        binary_name: "mysql-ps"
        extra_files: .env.example ReadMe.md
        retry: 10
        asset_name: "${BINARY_NAME}-${RELEASE_TAG}-ubuntu-2204-${GOARCH}"
  release-centos7-amd64:
    name: release linux/amd64
    runs-on: ubuntu-22.04
    container: centos:7
    steps:
    - uses: bytedeco/javacpp-presets/.github/actions/deploy-centos@actions
    - uses: actions/checkout@v3
    - uses: wangyoucao577/go-release-action@v1.37
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        goos: linux
        goarch: amd64
        overwrite: TRUE
        ldflags: '-w -s'
        binary_name: "mysql-ps"
        extra_files: .env.example ReadMe.md
        retry: 10
        asset_name: "${BINARY_NAME}-${RELEASE_TAG}-centos7-${GOARCH}"
